<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NodeGraph.App.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="clr-namespace:NodeGraph.App.Controls"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="NodeGraph.App.Views.MainView"
             x:DataType="vm:DashboardViewModel">

  <Design.DataContext>
    <vm:DashboardViewModel />
  </Design.DataContext>

  <Grid RowDefinitions="Auto,*">
    <!-- ヘッダーバー -->
    <Border Grid.Row="0"
            Background="{DynamicResource WindowHeaderBackgroundBrush}"
            Padding="10,8">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <!-- タイトル -->
        <TextBlock Grid.Column="0"
                   Text="NodeGraph"
                   FontSize="18"
                   FontWeight="Bold"
                   VerticalAlignment="Center" />

        <!-- 操作説明 -->
        <TextBlock Grid.Column="1"
                   Text="中ボタン/右ボタンでドラッグ移動 | マウスホイールでズーム"
                   Foreground="{DynamicResource WindowInfoForegroundBrush}"
                   VerticalAlignment="Center"
                   Margin="20,0,0,0" />

        <!-- 右側ボタン -->
        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
          <Button Content="Undo"
                  Command="{Binding UndoCommand}"
                  Padding="8,4" />
          <Button Content="Redo"
                  Command="{Binding RedoCommand}"
                  Padding="8,4" />
          <Button Content="Toggle Panel"
                  Command="{Binding ToggleLeftPanelCommand}"
                  Padding="8,4"
                  ToolTip.Tip="Toggle Left Panel" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- メインコンテンツ -->
    <Grid Grid.Row="1" ColumnDefinitions="Auto,Auto,*">

      <!-- 左パネル (グラフ一覧 + パラメータ) -->
      <Grid Grid.Column="0"
            Width="250"
            RowDefinitions="*,5,Auto"
            IsVisible="{Binding IsLeftPanelVisible}">
        <!-- グラフ一覧 -->
        <controls:GraphListControl Grid.Row="0" />

        <!-- スプリッター -->
        <GridSplitter Grid.Row="1"
                      Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" />

        <!-- パラメータパネル -->
        <controls:DashboardParametersPanel Grid.Row="2"
                                           MinHeight="150"
                                           MaxHeight="300" />
      </Grid>

      <!-- 垂直スプリッター -->
      <GridSplitter Grid.Column="1"
                    Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                    IsVisible="{Binding IsLeftPanelVisible}" />

      <!-- 右パネル (グラフエディタ + 出力) -->
      <Grid Grid.Column="2" RowDefinitions="*,5,Auto">
        <!-- グラフエディタ -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto">
          <!-- GraphControl -->
          <controls:GraphControl Grid.Column="0"
                                 Graph="{Binding CurrentGraph}"
                                 UndoRedoManager="{Binding UndoRedoManager}"
                                 Background="{DynamicResource GraphBackgroundBrush}" />

          <!-- Inspector スプリッター (将来用) -->
          <GridSplitter Grid.Column="1"
                        Width="5"
                        Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                        IsVisible="False" />

          <!-- Inspector Panel (将来用) -->
          <Border Grid.Column="2"
                  Width="280"
                  Background="{DynamicResource WindowHeaderBackgroundBrush}"
                  IsVisible="False">
            <controls:InspectorControl DataContext="{Binding InspectorViewModel}" />
          </Border>
        </Grid>

        <!-- 水平スプリッター -->
        <GridSplitter Grid.Row="1"
                      Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                      IsVisible="{Binding IsOutputPanelVisible}" />

        <!-- 実行出力パネル -->
        <controls:ExecutionOutputPanel Grid.Row="2"
                                       MinHeight="100"
                                       MaxHeight="250"
                                       IsVisible="{Binding IsOutputPanelVisible}" />
      </Grid>
    </Grid>
  </Grid>
</UserControl>
