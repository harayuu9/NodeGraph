<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NodeGraph.App.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="clr-namespace:NodeGraph.App.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="NodeGraph.App.Views.MainView"
             x:DataType="vm:MainWindowViewModel">

  <Design.DataContext>
    <vm:MainWindowViewModel />
  </Design.DataContext>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- メニューバー -->
    <Menu Grid.Row="0">
      <MenuItem Header="_File">
        <MenuItem Header="_New" Command="{Binding NewCommand}" InputGesture="Ctrl+N" />
        <MenuItem Header="_Open..." Command="{Binding OpenCommand}" InputGesture="Ctrl+O" />
        <MenuItem Header="_Save" Command="{Binding SaveCommand}" InputGesture="Ctrl+S" />
        <MenuItem Header="Save _As..." Command="{Binding SaveAsCommand}" InputGesture="Ctrl+Shift+S" />
        <Separator />
        <MenuItem Header="E_xit" Command="{Binding ExitCommand}" />
      </MenuItem>
      <MenuItem Header="_Edit">
        <MenuItem Header="_Undo" Command="{Binding UndoCommand}" InputGesture="Ctrl+Z" />
        <MenuItem Header="_Redo" Command="{Binding RedoCommand}" InputGesture="Ctrl+Y" />
      </MenuItem>
      <MenuItem Header="_View">
        <MenuItem Header="_Inspector" Command="{Binding ToggleInspectorCommand}" InputGesture="Ctrl+I">
          <MenuItem.Icon>
            <CheckBox IsChecked="{Binding IsInspectorVisible}" BorderThickness="0" IsHitTestVisible="False" />
          </MenuItem.Icon>
        </MenuItem>
        <Separator />
        <MenuItem Header="_Execution History" Command="{Binding OpenExecutionHistoryCommand}" InputGesture="Ctrl+H" />
      </MenuItem>
    </Menu>

    <!-- ヘッダー -->
    <Border Grid.Row="1" Background="{DynamicResource WindowHeaderBackgroundBrush}" Padding="10">
      <Grid ColumnDefinitions="*,Auto">
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="10">
          <TextBlock Text="GraphControl テスト"
                     FontSize="16"
                     FontWeight="Bold"
                     VerticalAlignment="Center" />
          <TextBlock Text="中ボタン/右ボタンでドラッグ移動 | マウスホイールでズーム"
                     Foreground="{DynamicResource WindowInfoForegroundBrush}"
                     VerticalAlignment="Center" />
        </StackPanel>

        <!-- テーマ切り替え -->
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="5" VerticalAlignment="Center">
          <Button Content="Parameters"
                  Command="{Binding OpenParametersCommand}"
                  Padding="8,4" />
          <Button Content="Execute"
                  Command="{Binding ExecuteGraphCommand}"
                  Padding="8,4" />
          <Button Content="Copy Mermaid"
                  Command="{Binding CopyMermaidToClipboardCommand}"
                  Padding="8,4"
                  Margin="0,0,15,0" />
          <TextBlock Text="テーマ:" VerticalAlignment="Center" Margin="0,0,5,0" />
          <Button Content="Default"
                  Command="{Binding SwitchThemeCommand}"
                  CommandParameter="Default"
                  IsEnabled="{Binding !IsDefaultTheme}"
                  Padding="8,4" />
          <Button Content="Light"
                  Command="{Binding SwitchThemeCommand}"
                  CommandParameter="Light"
                  IsEnabled="{Binding !IsLightTheme}"
                  Padding="8,4" />
          <Button Content="Dark"
                  Command="{Binding SwitchThemeCommand}"
                  CommandParameter="Dark"
                  IsEnabled="{Binding !IsDarkTheme}"
                  Padding="8,4" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- メインコンテンツ (GraphControl + Inspector) -->
    <Grid Grid.Row="2" ColumnDefinitions="*,Auto,Auto">
      <!-- GraphControl -->
      <controls:GraphControl Grid.Column="0"
                             Graph="{Binding TestGraph}"
                             UndoRedoManager="{Binding UndoRedoManager}"
                             Background="{DynamicResource GraphBackgroundBrush}" />

      <!-- スプリッター -->
      <GridSplitter Grid.Column="1"
                    Width="5"
                    Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                    IsVisible="{Binding IsInspectorVisible}" />

      <!-- Inspector Panel -->
      <Border Grid.Column="2"
              Width="280"
              Background="{DynamicResource WindowHeaderBackgroundBrush}"
              IsVisible="{Binding IsInspectorVisible}">
        <controls:InspectorControl DataContext="{Binding InspectorViewModel}" />
      </Border>
    </Grid>
  </Grid>

</UserControl>
