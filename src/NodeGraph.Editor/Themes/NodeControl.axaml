<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="clr-namespace:NodeGraph.Editor.Controls"
                    xmlns:models="clr-namespace:NodeGraph.Editor.Models"
                    xmlns:viewmodels="clr-namespace:NodeGraph.Editor.ViewModels"
                    x:CompileBindings="True">
  <Design.PreviewWith>
    <Border Padding="20">
      <controls:NodeControl>
        <!-- <controls:PortControl/> -->
      </controls:NodeControl>
    </Border>
  </Design.PreviewWith>
  <ControlTheme x:Key="{x:Type controls:NodeControl}" TargetType="controls:NodeControl">

    <Setter Property="Background" Value="{DynamicResource NodeBackgroundBrush}" />
    <Setter Property="BorderBrush" Value="{DynamicResource NodeBorderBrush}" />
    <Setter Property="BorderThickness" Value="2" />
    <Setter Property="CornerRadius" Value="4" />

    <Setter Property="Template">
      <ControlTemplate>
        <Border Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="{TemplateBinding BorderThickness}"
                CornerRadius="{TemplateBinding CornerRadius}"
                BoxShadow="{DynamicResource NodeBoxShadow}">
          <Grid RowDefinitions="Auto,*">
            <!-- ヘッダー -->
            <Border Grid.Row="0"
                    Background="{DynamicResource NodeHeaderBackgroundBrush}"
                    CornerRadius="4 4 0 0"
                    Padding="8,4">
              <TextBlock Text="{Binding Node.Name, RelativeSource={RelativeSource TemplatedParent}}"
                         FontWeight="SemiBold"
                         Foreground="{DynamicResource NodeHeaderForegroundBrush}" />
            </Border>

            <!-- ボディエリア -->
            <Grid Grid.Row="1" RowDefinitions="*,*">
              <Grid Grid.Row="0" ColumnDefinitions="*,*" Margin="0, 5,0,5">
                <!-- Input Ports -->
                <ItemsControl Grid.Column="0"
                              ItemsSource="{Binding Node.InputPorts, RelativeSource={RelativeSource TemplatedParent}}"
                              Margin="0,0,5,0">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="models:EditorPort">
                      <controls:PortControl Port="{Binding}"
                                            VerticalAlignment="Center"
                                            Direction="Left"
                                            Margin="2,2,0,2" />
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Output Ports -->
                <ItemsControl Grid.Column="1"
                              ItemsSource="{Binding Node.OutputPorts, RelativeSource={RelativeSource TemplatedParent}}"
                              HorizontalAlignment="Right">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="models:EditorPort">
                      <controls:PortControl Port="{Binding}"
                                            VerticalAlignment="Center"
                                            Direction="Right"
                                            Margin="0,2,2,2" />
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </Grid>

              <!-- コンテンツエリア (プロパティ表示) -->
              <StackPanel Grid.Row="1" Margin="5,0,5,5">
                <!-- プロパティリスト -->
                <ItemsControl ItemsSource="{Binding Node.Properties, RelativeSource={RelativeSource TemplatedParent}}">
                  <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                      <StackPanel Spacing="5"/>
                    </ItemsPanelTemplate>
                  </ItemsControl.ItemsPanel>
                  <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="viewmodels:PropertyViewModel">
                      <StackPanel Orientation="Horizontal" Spacing="5">
                        <controls:PropertyControlPresenter PropertyViewModel="{Binding}"/>
                      </StackPanel>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- カスタムコンテンツ -->
                <ContentPresenter x:Name="PART_ContentPresenter"
                                  Content="{TemplateBinding Content}"
                                  ContentTemplate="{TemplateBinding ContentTemplate}"
                                  Padding="{TemplateBinding Padding}"
                                  RecognizesAccessKey="True"
                                  HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                  VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}" />
              </StackPanel>
            </Grid>
          </Grid>
        </Border>
      </ControlTemplate>
    </Setter>

    <Style Selector="^:pointerover">
      <Setter Property="BorderBrush" Value="{DynamicResource NodeBorderHoverBrush}" />
    </Style>

    <Style Selector="^:selected">
      <Setter Property="BorderBrush" Value="{DynamicResource NodeBorderSelectedBrush}" />
    </Style>

  </ControlTheme>
</ResourceDictionary>